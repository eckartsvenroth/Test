<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Wichtel-Domino üéÅ</title>
  <style>
    :root{
      --bg:#0b1220;
      --tile:#ffffff;
      --accent:#0ea5a4;
      --muted:#94a3b8;
      --domino-dark:#0f1724;
      --domino-light:#e6eef6;
    }
    html,body{
      height:100%;
      margin:0;
      font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial;
    }
    body{
      background:linear-gradient(180deg,#061126,#0b1b2b);
      color:var(--tile);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }
    .app{
      max-width:1100px;
      width:100%;
    }
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:14px;
    }
    h1{
      margin:0;
      font-size:1.4rem;
      color:#e6f2fb;
    }
    .hint{
      color:var(--muted);
      font-size:.9rem;
    }
    .board{
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:18px;
    }
    .tile{
      background:linear-gradient(180deg,var(--domino-light),#fff);
      border-radius:12px;
      height:140px;
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      box-shadow:0 12px 30px rgba(2,6,23,.55);
      transform-origin:center;
      transition:transform .18s,opacity .18s,filter .18s;
      border:6px solid var(--domino-dark);
      user-select:none;
      overflow:hidden;
    }
    .tile.used{
      filter:grayscale(.5);
      opacity:.7;
      cursor:not-allowed;
      transform:translateY(4px);
    }
    .name{
      font-weight:800;
      font-size:1.05rem;
      color:#0b2440;
    }
    dialog{
      border:0;
      border-radius:16px;
      padding:20px 28px;
      box-shadow:0 8px 40px rgba(0,0,0,.6);
      font-size:1rem;
      background:#fff;
      color:#021;
      max-width:320px;
      text-align:center;
    }
    dialog::backdrop{background:rgba(0,0,0,.65)}
    .btn{
      background:var(--accent);
      border:0;
      padding:10px 16px;
      border-radius:10px;
      cursor:pointer;
      font-weight:700;
      color:#022;
    }
    .btn.cancel{
      background:#ccc;
      color:#222;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>üé≤ Wichtel-Domino (anonym)</h1>
        <div class="hint">Ziehe deinen Wichtel mit PIN ‚Äî Info verschwindet nach 7 Sekunden</div>
      </div>
    </header>
    <div class="board" id="board"></div>
  </div>

  <dialog id="pinDialog">
    <p id="dialogText">PIN f√ºr <b id="dialogName"></b> eingeben:</p>
    <input type="password" id="pinInput" maxlength="4" style="font-size:1.2rem;padding:6px 10px;text-align:center;" />
    <div style="margin-top:14px;">
      <button class="btn" id="okBtn">OK</button>
      <button class="btn cancel" id="cancelBtn">Abbrechen</button>
    </div>
  </dialog>

  <dialog id="resultDialog">
    <p id="resultText"></p>
  </dialog>

  <script>
    const API_BASE = 'test-rho-seven-98.vercel.app'; // <- dein Backend-Link

    const names = ["Anneliese","Gerhard","Anca","Carsten","Nang","Ecki","Nook","Gam"];
    const used = new Set();
    const board = document.getElementById("board");
    const pinDialog = document.getElementById("pinDialog");
    const resultDialog = document.getElementById("resultDialog");
    const dialogName = document.getElementById("dialogName");
    const pinInput = document.getElementById("pinInput");
    const okBtn = document.getElementById("okBtn");
    const cancelBtn = document.getElementById("cancelBtn");
    const resultText = document.getElementById("resultText");

    let currentName = null;

    function renderBoard(){
      board.innerHTML = "";
      names.forEach(name=>{
        const div = document.createElement("div");
        div.className = "tile";
        div.innerHTML = `<span class='name'>${name}</span>`;
        if(used.has(name)) div.classList.add("used");
        div.addEventListener("click",()=>onTileClick(name,div));
        board.appendChild(div);
      });
    }

    function onTileClick(name,div){
      if(used.has(name)) return;
      currentName = name;
      dialogName.textContent = name;
      pinInput.value="";
      pinDialog.showModal();
      pinInput.focus();
    }

    cancelBtn.onclick = ()=>pinDialog.close();

    okBtn.onclick = async ()=>{
      const pin = pinInput.value.trim();
      if(!pin) return alert("Bitte PIN eingeben");
      try{
        const res = await fetch(`${API_BASE}/api/draw`,{
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body:JSON.stringify({pin})
        });
        if(!res.ok){
          alert("Ung√ºltige PIN!");
          return;
        }
        const data = await res.json();
        pinDialog.close();
        showResult(data.wichtel);
        used.add(data.name);
        renderBoard();
      }catch(e){
        alert("Fehler beim Abrufen. Pr√ºfe API-URL.");
        console.error(e);
      }
    };

    function showResult(name){
      resultText.textContent = `üéÅ Du beschenkst: ${name}`;
      resultDialog.showModal();
      setTimeout(()=>{
        resultDialog.close();
      },7000);
    }

    renderBoard();
  </script>
</body>
</html>
